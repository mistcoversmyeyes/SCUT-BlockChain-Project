# ERC20合约API测试说明

## 📋 测试流程概述

本测试脚本将完整测试JYMToken ERC20合约的5个核心接口，每个接口都需要：
1. **调用截图** - 证明接口被成功调用（有交易哈希）
2. **验证截图** - 证明操作确实生效（余额/授权额度变化）

---

## 🔧 第一步：MetaMask 钱包联动配置

### 1.1 导出 MetaMask 私钥并配置

1. **导出私钥**：
   - MetaMask → 账户详情 → 导出私钥
   - 输入钱包密码，复制私钥（格式：0x开头）

2. **配置 application.properties**：
   ```properties
   web3j.private-key=0x你的MetaMask私钥
   ```

3. **获取你的 MetaMask 地址**：
   - 在 MetaMask 中复制你的钱包地址（格式：0x开头）

### 1.2 配置测试脚本

编辑 `spring-boot-web3j/test_erc20_api.sh`，修改这两行：

```bash
# 第15行：替换为你的 MetaMask 地址（必须与私钥对应）
YOUR_ADDRESS="0x你的MetaMask地址"

# 第19行：替换为接收者地址（可以是你的第二个 MetaMask 账户）
RECEIVER_ADDRESS="0x接收者地址"
```

**重要提醒**：
- `YOUR_ADDRESS` 必须与配置文件中的私钥对应
- 确保钱包中有足够的测试网 ETH
- 确保已配置 POTOS 测试网

---

## 🚀 第二步：启动后端服务

```bash
cd /home/yuming/SCUT/SCUT_25_Fall/SCUT-BlockChain-Project/spring-boot-web3j

# 启动服务（占用终端）
bash gradlew bootRun
```

**等待看到以下日志表示启动成功：**
```
Started Application in X.XXX seconds
```

---

## 🧪 第三步：运行测试脚本

**新开一个终端窗口**，运行：

```bash
cd /home/yuming/SCUT/SCUT_25_Fall/SCUT-BlockChain-Project/spring-boot-web3j
bash test_erc20_api.sh
```

### 预期结果
- 合约部署到你的 MetaMask 地址
- 1,000,000 JYM 自动铸造到你的 MetaMask
- 可以在 MetaMask 中查看所有交易记录

---

## 📸 第四步：截图要求详解

### 📸 需要截图的内容（共11张截图）

#### 接口1：mint
- **调用截图1**：curl命令 + 返回的transactionHash
- **验证截图2**：mint前后余额对比（显示增加了）

#### 接口2：transfer
- **调用截图3**：curl命令 + 返回的transactionHash
- **验证截图4**：转账前后发送方和接收方余额变化

#### 接口3：balanceOf
- **调用截图5**：curl命令 + 返回的余额查询结果
- **验证截图6**：查询另一个地址的余额（无变化）

#### 接口4：approve
- **调用截图7**：curl命令 + 返回的transactionHash
- **验证截图8**：授权前后allowance对比（显示增加了）

#### 接口5：transferFrom
- **调用截图9**：curl命令 + 返回的transactionHash
- **验证截图10**：transferFrom后余额和授权额度变化

#### 🆕 钱包联动验证
- **截图11**：MetaMask 中显示的 JYMToken 余额（1,000,000+ JYM）

---

## 📊 预期结果示例

### 部署后
```json
{
  "contractAddress": "0x1234...abcd",
  "message": "JYMToken contract deployed successfully",
  "initialSupply": "1000000000000000000000000",
  "tokenName": "JYMToken",
  "tokenSymbol": "JYM"
}
```

### Mint后验证
```json
{
  "balance": "1100000000000000000000000",  // 100万 + 100 = 110万
  "balanceReadable": "1100 JYM"
}
```

### Transfer后验证
```json
// 发送方余额减少
{
  "balance": "1050000000000000000000000",
  "balanceReadable": "1050 JYM"
}

// 接收方余额增加
{
  "balance": "50000000000000000000",
  "balanceReadable": "50 JYM"
}
```

### Approve后验证
```json
{
  "allowance": "100000000000000000000",
  "allowanceReadable": "100 JYM"
}
```

### TransferFrom后验证
```json
{
  "balance": "1020000000000000000000000",  // 1050 - 30 = 1020
  "balanceReadable": "1020 JYM"
}
{
  "allowance": "70000000000000000000",     // 100 - 30 = 70
  "allowanceReadable": "70 JYM"
}
```

---

## ❗ 常见问题

### Q1: 提示 "Contract not deployed"
**A:** 重新运行部署接口：`curl -X POST http://localhost:8080/api/jym/deploy`

### Q2: 交易失败（status: 0x0）
**A:** 检查：
- 是否有足够的ETH支付Gas
- 地址格式是否正确（42位，以0x开头）
- amount是否为数字字符串

### Q3: 余额显示为0
**A:** 检查：
- 地址是否正确
- 合约是否已部署
- 地址是否为小写

### Q4: 如何在浏览器查看交易？
**A:** 将返回的transactionHash粘贴到Potos区块浏览器：
`https://potos-scan.hk/`

---

## ✅ 提交清单

- [ ] **钱包联动配置**：application.properties 中的私钥与 MetaMask 对应
- [ ] **测试脚本运行成功**：所有 5 个接口调用成功
- [ ] **11张截图**：5个接口（10张）+ MetaMask 钱包验证（1张）
- [ ] **截图质量**：包含命令和完整返回结果
- [ ] **验证截图**：显示数据变化（余额、授权额度）
- [ ] **交易记录**：可在 MetaMask 中查看所有交易
- [ ] **钱包验证**：MetaMask 中显示正确的 JYM 余额

## 🎯 大作业钱包联动要求完成情况

- ✅ **ERC20 标准合约**：实现所有必需接口（mint, transfer, balanceOf, approve, transferFrom）
- ✅ **钱包联动部署**：合约部署到个人 MetaMask 地址
- ✅ **代币铸造验证**：1,000,000 JYM 显示在 MetaMask 中
- ✅ **API 与钱包交互**：通过 REST API 操作的代币可在 MetaMask 中查看
- ✅ **交易可追溯性**：所有交易都在 MetaMask 中有记录

---

## 📝 报告撰写建议

在报告中按以下顺序展示：

1. **钱包联动配置说明**：
   - application.properties 私钥配置
   - MetaMask 地址与私钥对应关系

2. **接口调用截图**（按mint → transfer → balanceOf → approve → transferFrom顺序）

3. **验证结果截图**（紧跟每个接口的调用截图）

4. **MetaMask 钱包联动验证截图**：
   - JYMToken 在 MetaMask 中的余额显示
   - 交易记录截图

5. **文字说明**：
   - 接口功能
   - 参数含义
   - 返回结果解读
   - 验证成功的证据
   - 钱包联动成功的证明

每张截图都要有：
- 清晰的命令（用代码块展示）
- 完整的JSON响应
- 关键数据高亮（如transactionHash、balanceReadable）
- MetaMask 余额显示（钱包联动证据）
